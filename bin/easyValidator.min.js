!function($){if($.fn.validatebox){$.fn.validatebox.defaults.dtb={"组织机构代码":/^\w{8}[-]\w$/,"邮政编码":/^[1-9]\d{5}$/,"手机号码":/^1\d{10}$/,"座机号码":/^(\(?0\d{2,3}\)?[- ]?)?\d{7,8}$/,"联系电话":/^(1\d{10})|((\(?0\d{2,3}\)?[- ]?)?\d{7,8})$/},$.fn.validatebox.defaults.mtb={"日期":/(\d{4})([-\/.])(\d{1,2})\2(\d{1,2})/},$.fn.validatebox.defaults.cmpCore=function(v1,v2,relation){switch(relation){case"大于":return v1>v2;break;case"大于等于":return v1>=v2;break;case"小于":return v1<v2;break;case"小于等于":return v1<=v2;break;case"不等于":return v1!=v2;break;default:return v1==v2;break}},$.fn.validatebox.defaults.getTextFromInput=function(s){return $(s).parent().text().replace(/(\:\*$)|(\:$)|(&nbsp;)/g,"")},$.extend($.fn.validatebox.defaults.rules,{compare:{validator:function(value,param){var regValue=value.match($.fn.validatebox.defaults.mtb["日期"]);var fthis;var ftarget;if(regValue){fthis=(new Date(regValue[1],parseInt(regValue[3],10)-1,regValue[4])).getTime()}else{fthis=parseFloat(value)}switch(typeof(param[0])){case"object":ftarget=param[0].getTime();param[2]="当前日期";break;case"number":ftarget=param[0];param[2]=param[0];break;case"string":if($(param[0]).hasClass("datebox-f")){ftarget=$(param[0]).datebox("getValue")||$(param[0]).datebox("getText");if(ftarget.length<=0){param[1]="先选";param[2]=$.fn.validatebox.defaults.getTextFromInput(param[0]);return false}regValue=ftarget.match($.fn.validatebox.defaults.mtb["日期"]);ftarget=(new Date(regValue[1],parseInt(regValue[3],10)-1,regValue[4])).getTime()}else{ftarget=parseFloat($(param[0]).val())}break;default:return;break}if(!param[2]){param[2]=$.fn.validatebox.defaults.getTextFromInput(param[0])}if(isNaN(fthis)||isNaN(ftarget)){return true}else{return $.fn.validatebox.defaults.cmpCore(fthis,ftarget,param[1])}},message:"必须{1}{2}"},format:{validator:function(value,param){var dtb=$.fn.validatebox.defaults.dtb;if(param[1]==undefined){param[1]="请输入正确的"+param[0]}return dtb[param[0]].test(value)},message:"{1}"},condFormat:{validator:function(value,param){var v;if(typeof(param[0])=="function"){v=param[0]()}else{v=eval(param[0])}if(v){var dtb=$.fn.validatebox.defaults.dtb;if(param[2]==undefined){param[2]="请输入正确的"+param[1]}return dtb[param[1]].test(value)}else{return true}},message:"{2}"},idCard:{validator:function(value,param){if(param){if(typeof(param[0])=="function"){var val=param[0]();if(!val){return true}}}var idcard=value;var cities={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};idcard=idcard.toString();if(!(idcard.length==15||idcard.length==18)){return false}var info=idcard.length==15?idcard.match(/([1-9]\d)\d{4}(\d{2})(\d{2})(\d{2})\d{2}(\d)/i):idcard.match(/([1-9]\d)\d{4}(\d{4})(\d{2})(\d{2})\d{2}(\d)[\dx]/i);if(!info.length){return false}if(!cities[info[1]]){return false}var birthday=new Date(info[2],info[3]-1,info[4]);if(!((birthday.getFullYear()==info[2]||birthday.getYear()==info[2])&&birthday.getMonth()+1==parseInt(info[3],10)&&birthday.getDate()==parseInt(info[4],10))){return false}if(info[0].length==18){var sum=0;info[0]=info[0].replace(/x/i,"a");for(var i=17;i>=0;i--){sum+=(Math.pow(2,i)%11)*parseInt(info[0].charAt(17-i),11)}if((sum%11)!=1){return false}}return true},message:"请输入合法的大陆居民身份证号"},sumCompare:{validator:function(value,param){var sumText=$.fn.validatebox.defaults.getTextFromInput(param[0]);var addendText=[];var addendValue=0;for(var i=3;i<param.length;i++){addendText.push($.fn.validatebox.defaults.getTextFromInput(param[i]));addendValue+=parseFloat($(param[i]).val())}if(!param[2]){param[2]=sumText+"必须"+param[1]+"以下值的和:<br/>";param[2]+=addendText.toString()}var fthis=parseFloat($(param[0]).val());var ftarget=parseFloat(addendValue);return $.fn.validatebox.defaults.cmpCore(fthis,ftarget,param[1])},message:"{2}"},gridCompare:{validator:function(value,param){var fieldName=param[0];var grid=param[1];var relation=param[2];if(window.currRowIdx){grid=$(grid);var targetEditor=grid.datagrid("getEditor",{index:window.currRowIdx,field:fieldName});var ftarget=targetEditor.actions.getValue(targetEditor.target);var regValue=value.match($.fn.validatebox.defaults.mtb["日期"]);if(regValue){fthis=(new Date(regValue[1],parseInt(regValue[3],10)-1,regValue[4])).getTime()}else{fthis=parseFloat(value)}switch(targetEditor.type){case"datebox":if(ftarget.length<=0){param[2]="先选";param[3]=grid.datagrid("getColumnOption",fieldName).title;return false}regValue=ftarget.match($.fn.validatebox.defaults.mtb["日期"]);ftarget=(new Date(regValue[1],parseInt(regValue[3])-1,regValue[4])).getTime();break;default:ftarget=parseFloat(ftarget);break}if(!param[3]){param[3]=grid.datagrid("getColumnOption",fieldName).title}return $.fn.validatebox.defaults.cmpCore(fthis,ftarget,relation)}else{return true}},message:"必须{2}{3}"}})}}(jQuery);!function($){$.fn.extend({extData:function(key,obj){var dd=this.data(key);if(dd){this.data(key,$.extend({},dd,obj))}else{this.data(key,obj)}return this}});var customValidator={scrollObj:window,scrollObjInit:-12,inValidAry:[],attrReg:/(\w+)\[?([^\]]*)\]?/,combReg:/(\w+)\{?([^\}]*)\}?/,init:function(container){var valid=this;valid.scrollObj=$("#scrollDom,#center-layout").length>0?$("#scrollDom,#center-layout"):$(document.body);$("input:checkbox[name][eValid],input:radio[name][eValid]",container).each(function(){var obj=this;var $obj=$(obj);var oriAttr=$obj.attr("eValid");if(oriAttr){$("input:"+$obj.attr("type")+"[name='"+obj.name+"']").removeAttr("eValid").first().attr("eValid",oriAttr)}});$("input[name][eValid^=required1]",container).each(function(){var $obj=$(this);if(!$obj.data("eValid")){var oriAttr=$(this).attr("eValid");if(oriAttr){var mark1=oriAttr.match(valid.attrReg);if(mark1.length>0){var allobj=$("input[name][eValid^=required1][eValid*="+mark1[2]+"]").removeAttr("eValid");var allobjf=allobj.first().attr("eValid",oriAttr).extData("eValid",{chkobj:allobj,hasInit:true});allobj.bind("blur.eValid keyup.eValid",function(){valid.validate1(allobjf)})}}}});$("[eValid][comboName]",container).each(function(){var obj=$(this);var oriValue=obj.attr("eValid");obj.removeAttr("eValid").next("span").find("input.combo-text").attr("eValid",oriValue)});$("[eValid]",container).each(function(){var obj=this;var $obj=$(obj);var objData=$obj.data("eValid");if(objData){return}$obj.data("eValid",{});if(/(input)|(select)|(textarea)/i.test(obj.tagName)){if($obj.attr("type")=="checkbox"||$obj.attr("type")=="radio"){$("input[name='"+obj.name+"']").bind("click.eValid",function(){valid.validate1(obj)})}else{$(this).bind("blur.eValid keyup.eValid",function(){valid.validate1(obj)})}}})},validate:function(func,container){var valid=this;valid.inValidAry=new Array();$(".gn-inValidate").removeClass("gn-inValidate");$("[eValid]",container).each(function(){valid.validate1(this)});$(".gn-inValidate,.validatebox-invalid").each(function(){valid.inValidAry.push(valid.getBoxText(this))});var iv=$(".gn-inValidate:first",container).focus();return iv.length<=0},validate1:function(obj,myAttr){var valid=this;var $Obj=$(obj);var objData=$Obj.data("eValid");if(objData){if(objData.disabled=="1"||objData.disabled==1){return true}}else{valid.init()}var desc;if($.fn.validatebox&&$.fn.validatebox.defaults.getTextFromInput){desc=$.fn.validatebox.defaults.getTextFromInput(obj)}if(objData.message){desc=objData.message}else{desc=(desc?desc+"为":"")+"必填项"}var objAttr=myAttr||$Obj.attr("eValid");var objAttrM=objAttr.match(valid.attrReg);switch(objAttrM.length>1?objAttrM[1]:objAttr){case"combine":objAttrM=objAttr.match(combReg);if(objAttrM[2]){$.each(objAttrM[2].split("|"),function(objIdx,objVal){valid.validate1(obj,objVal)})}break;case"required":if(objAttrM[2]){var fobjAttrM=eval(objAttrM[2]);if(typeof fobjAttrM=="function"&&!fobjAttrM()){break}}if($Obj.attr("type")=="radio"||$Obj.attr("type")=="checkbox"){if($("input[name='"+obj.name+"']:checked").length==0){valid.cmbSet1Error(obj,desc)}else{valid.cmbClr1Error(obj)}}else{if($Obj.hasClass("combo-text")){if($Obj.parent().find(">input.combo-value").val()==""){valid.cmbSet1Error(obj,desc)}else{valid.cmbClr1Error(obj)}}else{if($Obj.val()==""){valid.cmbSet1Error(obj,desc)}else{valid.cmbClr1Error(obj)}}}break;case"required1":var $Obj1={};if(objData.chkobj){$Obj1=objData.chkobj}else{var sltStr="[eValid^=required1][eValid*="+objAttrM[2]+"]";$Obj1=$(sltStr)}var totalVal="",totalDesc=[];$Obj1.each(function(idx,rObj){totalDesc.push(valid.getInputDesc(rObj));totalVal+=$(rObj).val()});if(totalVal.length<=0){$Obj1.each(function(idx,rObj){valid.cmbSet1Error(obj,totalDesc.join(",")+"必填其中一项")})}else{$Obj1.each(function(idx,rObj){valid.cmbClr1Error(obj)})}break;case"unique":$Obj.data("eValid").unique();break;default:return true}},getInputDesc:function(obj){if($.fn.validatebox&&$.fn.validatebox.defaults.getTextFromInput){return $.fn.validatebox.defaults.getTextFromInput(obj)}},getBoxText:function(obj){var tip=$(obj);if(tip.hasClass("inValidate-tip")){return this.getInputDesc(tip.parent().find("input"))}if(tip.hasClass("validatebox-invalid")||(tip.hasClass("gn-inValidate")&&tip.is("input"))){return this.getInputDesc(obj)}},cmbSet1Error:function(obj,errMsg){var data=$(obj).data("eValid");if(data){data.isValid=false;if(!$(obj).hasClass("gn-inValidate")){$(obj).addClass("gn-inValidate")}var t=$(".inValidate-tip",$(obj).parent());if(t.length==0){if(errMsg){data.message=errMsg}this.showMsg(obj);this.positionTips()}}},cmbClr1Error:function(obj){var data=$(obj).data("eValid");if(data){data.isValid=true;if($(obj).hasClass("gn-inValidate")){$(obj).removeClass("gn-inValidate")}$(".inValidate-tip",$(obj).parent()).remove()}},showMsg:function(obj){var errMsg="必填项";var eValidData=$(obj).data("eValid");if(eValidData&&eValidData.message){errMsg=eValidData.message}var l=$(obj).position().left;var t=$(obj).position().top;var tip='<div class="validatebox-tip inValidate-tip" style="position: absolute;"></div>';tip=$(tip);tip.css("display","block").css("left",l).css("top",t+this.scrollObjInit);tip.html('<span class="validatebox-tip-content validatebox-tip-content-move"><span class="validatebox-tip-content-inner">'+errMsg+'</span><span class="validatebox-tip-content-closer">×</span></span>');if(tip.draggable){tip.draggable({axis:"v",handle:".validatebox-tip-content-move"})}tip.find(".validatebox-tip-content-closer").click(function(){tip.remove()});tip.appendTo($(obj).parent())},positionTips:function(){var myObj=this;this.scrollObj.scroll(function(){$(".inValidate-tip").each(function(){$(this).css("top",$(this).parent().position().top+myObj.scrollObjInit)})})},clearErrMsg:function(selector){$(".gn-inValidate",selector).removeClass("gn-inValidate");$(".inValidate-tip",selector).remove()},changeValidateState:function(state,selector){$("[eValid]",selector).each(function(){var ipt=$(this);if(ipt.data("eValid")){ipt.extData("eValid",{disabled:state})}})},clearValidate:function(selector){this.clearErrMsg(selector);$("[eValid]",selector).unbind(".eValid").removeData("eValid");if(this.scrollObj&&selector==undefined){this.scrollObj.unbind(".eValid")}},removeValidate:function(selector){this.clearValidate(selector);$("[eValid]",selector).removeAttr("eValid")}};$.eValid=customValidator}(jQuery);